<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Detail - Portfolio</title>
    <link rel="stylesheet" href="../styles.css">
    <!-- PDF.js for PDF rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="project-nav">
        <a href="../index.html" class="back-button">‚Üê Back to Portfolio</a>
    </nav>

    <!-- Project Detail Content -->
    <main class="project-detail">
        <div class="project-media-container" id="project-media-container">
            <!-- Main media (image, video, or PDF) will be displayed here -->
            <img id="project-image" class="project-image" src="" alt="Project image" style="display: none;">
            <video id="project-video" class="project-video" controls style="display: none;">
                <source src="" type="video/quicktime">
                <source src="" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div id="project-pdf-container" class="project-pdf-container" style="display: none;">
                <div id="pdf-pages-wrapper" class="pdf-pages-wrapper"></div>
            </div>
        </div>
        <div class="project-content">
            <h1 class="project-title" id="project-title">Project Title</h1>
            <div class="project-description" id="project-description">
                <p>Project description will be displayed here.</p>
            </div>
        </div>
    </main>

    <script src="../projects.js"></script>
    <script src="../script.js"></script>
    <script>
        // Initialize PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }

        // Load project data from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id');
        
        if (projectId) {
            const project = getProjectById(projectId);
            if (project) {
                // Set title and description
                document.getElementById('project-title').textContent = project.title;
                document.getElementById('project-description').innerHTML = `<p>${project.description}</p>`;
                
                // Display appropriate media based on type
                const mediaContainer = document.getElementById('project-media-container');
                const imageEl = document.getElementById('project-image');
                const videoEl = document.getElementById('project-video');
                const pdfContainer = document.getElementById('project-pdf-container');
                
                if (project.mediaType === 'image') {
                    imageEl.src = project.mediaUrl;
                    imageEl.alt = project.title;
                    imageEl.style.display = 'block';
                } else if (project.mediaType === 'video') {
                    const sources = videoEl.querySelectorAll('source');
                    sources.forEach(source => {
                        source.src = project.mediaUrl;
                    });
                    videoEl.load();
                    videoEl.style.display = 'block';
                } else if (project.mediaType === 'pdf') {
                    pdfContainer.style.display = 'block';
                    loadPDF(project.mediaUrl);
                }
            } else {
                // Project not found
                document.getElementById('project-title').textContent = 'Project Not Found';
                document.getElementById('project-description').innerHTML = '<p>The requested project could not be found.</p>';
            }
        }

        // PDF loading - render all pages in infinite scroll
        let pdfDoc = null;
        const scale = 1.5;
        const pdfPagesWrapper = document.getElementById('pdf-pages-wrapper');

        function loadPDF(url) {
            if (typeof pdfjsLib === 'undefined') {
                console.error('PDF.js library not loaded');
                return;
            }

            pdfjsLib.getDocument(url).promise.then(function(pdf) {
                pdfDoc = pdf;
                pdfPagesWrapper.innerHTML = ''; // Clear any existing content
                
                // Render all pages
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    renderPage(pageNum);
                }
            }).catch(function(error) {
                console.error('Error loading PDF:', error);
                pdfPagesWrapper.innerHTML = 
                    '<p style="padding: 2rem; text-align: center; color: #666;">Error loading PDF. Please try again later.</p>';
            });
        }

        function renderPage(pageNum) {
            pdfDoc.getPage(pageNum).then(function(page) {
                const viewport = page.getViewport({scale: scale});
                
                // Create canvas for this page
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                canvas.className = 'pdf-page-canvas';
                
                // Create container for this page
                const pageContainer = document.createElement('div');
                pageContainer.className = 'pdf-page-container';
                pageContainer.appendChild(canvas);
                
                // Append to wrapper
                pdfPagesWrapper.appendChild(pageContainer);

                // Render the page
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                page.render(renderContext);
            });
        }
    </script>
</body>
</html>

